{% extends 'main/base.html' %}

{% block title %}
Добавление товара
{% endblock %}


{% block content %}
<!-- <h1>Управление товарами</h1> -->
<div class="main-content">

        <!-- Список товаров -->
        <div class="products-list">
            <h2>Товары в меню</h2>
            {% for category in categories %}    
                <!-- Товары -->
                <h3 class="name-category">{{category.name}}</h3>
                {% for product in category.products %}
                    <div class="product-item" id="{{product.id}}">
                        <img src="{{ url_for('static', filename=product.image_path) }}" alt="{{category.name}}" class="product-image">
                        <div class="product-info">
                            <div class="product-title">{{ product.title }}</div>
                            <span class="product-category">{{category.name}}</span>
                            <div class="product-description">{{ product.text }}</div>
                            <div class="product-details">
                                <span class="product-weight">{{ product.weight }} г</span>
                                <span class="product-price" >{{ product.weight }} BYN</span>
                            </div>
                        </div>
                        <div class="product-actions">
                            <button class="action-btn edit-btn" id="{{product.id}}">Изменить</button>
                            <button class="action-btn delete-btn" id="{{product.id}}">Удалить</button>
                        </div>
                    </div>
                    {% endfor %}
            {% endfor %}
            

        </div>
        
        <!-- Форма добавления товара -->
        <div class="form-container">
            <h2>Добавить новый товар</h2>
            
            <form method="POST" action="/add_product" enctype="multipart/form-data">
                <!-- Название товара -->
                <div class="form-group">
                    <label for="title">Название товара</label>
                    <input type="text" id="title" name="title" placeholder="Введите название" required>
                </div>
                
                <!-- Категория товара -->
                <div class="form-group">
                    <label for="category">Категория</label>
                    <select id="category" name="category" required>
                        <option value="">-- Выберите категорию --</option>
                        <option value="pizza">Пицца</option>
                        <option value="sushi">Суши</option>
                        <option value="wok">Wok</option>
                        <option value="salad">Салаты</option>
                        <option value="drink">Напитки</option>
                    </select>
                </div>
                
                <!-- Описание товара -->
                <div class="form-group">
                    <label for="text">Описание</label>
                    <textarea id="text" name="text" placeholder="Введите описание товара" required></textarea>
                </div>
                
                <div class="row">
                    <!-- Вес -->
                    <div class="col form-group">
                        <label for="weight">Вес (г)</label>
                        <input type="number" id="weight" name="weight" placeholder="0" required>
                    </div>
                    
                    <!-- Цена -->
                    <div class="col form-group">
                        <label for="price">Цена (₽)</label>
                        <input type="number" step="0.01" id="price" name="price" placeholder="0.00" required>
                    </div>
                </div>
                
                <!-- Изображение -->
                <div class="form-group">
                    <label for="image">Изображение товара</label>
                    <input type="file" id="image" name="image" accept="image/*" required>
                    <div class="form-text">Рекомендуемый размер: 800x600px</div>
                </div>
                
                <!-- Кнопка отправки -->
                <button type="submit" class="btn-submit">Добавить товар</button>
            </form>
        </div>
    </div>


<!-- Модальное окно -->
    <div class="modal-overlay" id="modalOverlay">
        <!-- Само модальное окно -->
        <div class="modal">
            <button class="close-modal-btn">&times;</button>
            <div class="modal-content">

                <!--  -->
                <div class="modal-product-content">
                    <img id="modalProductImage" class="modal-product-image" src="" alt="">
                    <div class="modal-product-details">
                        <!-- Название товара (input) -->
                        <input type="text" 
                            id="modalProductTitle" 
                            class="modal-product-title" 
                            value="Салями">

                        <!-- Описание товара (textarea) -->
                        <textarea id="modalProductDescription">FGBXFGBXFGB</textarea>

                        <div class="product-meta">
                            <!-- Вес товара (input) -->
                            <input type="text" 
                                class="product-modal-weight" 
                                value="None г">

                            <!-- Калории (input) -->
                            <input type="text" 
                                class="product-modal-calories" 
                                value="1250 ккал">
                        </div>

                        <!-- Цена (input) -->
                        <input type="text" 
                            id="modalProductPrice" 
                            class="product-modal-price" 
                            value="0 BYN">

                        <button class="modal-add-to-cart" id="0" onclick="addToCartModal(this.id)">Сохранить</button>
                    </div>
                </div>

                <!--  -->
            </div>
        </div>
    </div>


<script>
    // К каждой кнопке "Редактировать" добавляю модальное окно
    const edit_buttons = document.querySelectorAll(".edit-btn");
    
    edit_buttons.forEach(btn => {
        btn.addEventListener('click', function() {
            modalOverlay.style.display = 'block';

            card = btn.closest('.product-item');

            title = card.querySelector(".product-title").textContent
            description = card.querySelector(".product-description").textContent
            price = card.querySelector(".product-price").textContent
            image_path = card.querySelector(".product-image").src
            weight = card.querySelector('.product-weight').textContent

            document.getElementById('modalProductTitle').value = title;
            document.getElementById('modalProductPrice').value = price;
            document.querySelector('.product-modal-weight').value = weight
            document.getElementById('modalProductDescription').textContent = description;
            document.getElementById('modalProductImage').src = image_path;

        })
    })
    
    // Получаем элементы
        const openModalBtn = document.querySelector('.open-modal-btn');
        const closeModalBtn = document.querySelector('.close-modal-btn');
        const modalOverlay = document.getElementById('modalOverlay');
        
    // Закрываем модальное окно при клике на крестик
    closeModalBtn.addEventListener('click', function() {
        modalOverlay.style.display = 'none';
    });

    // Закрываем модальное окно при клике на затемненный фон
    modalOverlay.addEventListener('click', function(e) {
        if (e.target === modalOverlay) {
            modalOverlay.style.display = 'none';
        }
    });

</script>


{% endblock %}

